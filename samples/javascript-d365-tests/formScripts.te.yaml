# yaml-embedded-languages: powerfx
testSuite:
  testSuiteName: Form Script Tests
  testSuiteDescription: Tests for Dynamics 365 form script functionality using PowerFx format
  persona: User1
  appLogicalName: na

  testCases:    
    - testCaseName: FormScripts_DefaultCountryForNewForms
      testCaseDescription: Tests that default country is set for new forms
      testSteps: |
        = Preview.AssertJavaScript({Location:"formScripts.js", Setup:"mockXrm.js", Run: Join([
            "Xrm.Page.ui.formType = 1",
            "onLoad()",
            "Xrm.Page.getAttribute('address1_country').getValue() === 'United States'"
          ]), Expected: "true" });
    - testCaseName: FormScripts_UnchangedCountryForExistingForms
      testCaseDescription: Tests that country is not changed for existing forms
      testSteps: |
        = Preview.AssertJavaScript({Location:"formScripts.js", Setup:"mockXrm.js", Run: Join([
            "Xrm.Page.ui.formType = 2",
            "Xrm.Page.getAttribute('address1_country').setValue('Canada')",
            "onLoad()",
            "Xrm.Page.getAttribute('address1_country').getValue() === 'Canada'"
          ]), Expected: "true" });
    - testCaseName: FormScripts_CreditLimitRequiresScoreForHighLimit
      testCaseDescription: Tests that credit score is required for high credit limits
      testSteps: |
        = Preview.AssertJavaScript({Location:"formScripts.js", Setup:"mockXrm.js", Run: Join([
            "Xrm.Page.getAttribute('creditlimit').setValue(100000)",
            "creditLimitOnChange()",
            "Xrm.Page.getControl('creditscore').getRequiredLevel() === 'required'"
          ]), Expected: "true" });
    - testCaseName: FormScripts_CustomerTypeShowsPartnerTab
      testCaseDescription: Tests that partner tab is shown for partner customer type
      testSteps: |
        = Preview.AssertJavaScript({Location:"formScripts.js", Setup:"mockXrm.js", Run: Join([
            "Xrm.Page.getAttribute('customertype').setValue(2)",
            "customerTypeOnChange()",
            "Xrm.Page.ui.tabs.get('partnertab').getVisible()"
          ]), Expected: "true" });

testSettings:
  filePath: ./testSettings.yaml

environmentVariables:
  users:
    - personaName: User1
      emailKey: user1Email
      passwordKey: NotNeeded
