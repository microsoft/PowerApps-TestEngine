scan:
  name: Canvas App Scan
  description: Scan for Canvas App definitions to give context to Model Context Protocol (MCP) generation of tests
  version: 1.0.0
  onDirectory:
    - When: Find(ThisNode.Path, "canvasapps") > 0
      Then: AddContext(ThisNode, "Canvas App Source Directory")
    - When: Find(ThisNode.Path, "Src") > 0
      Then: AddContext(ThisNode, "Source Folder")

  onFile:
    - When: IsMatch(ThisNode.Name, ".*\\.ya\\.yaml")
      Then: AddContext(ThisNode, "Canvas App YAML")
    - When: IsMatch(ThisNode.Name, ".*screen.*")
      Then: AddContext(ThisNode, "UI Screen File")

  onControl:
    - When: IsMatch(ThisNode.Name, ".*Icon.*")
      Then: AddFact(ThisNode)
    - When: IsMatch(ThisNode.Name, ".*Button.*")
      Then: AddFact(ThisNode)
    - When: IsMatch(ThisNode.Name, ".*Input.*")
      Then: AddFact(ThisNode)

  onProperty:
    - When: IsMatch(ThisNode.Name, "Visible")
      Then: AddFact(ThisNode)
    - When: IsMatch(ThisNode.Name, "OnSelect")
      Then: AddFact(ThisNode)
    - When: IsMatch(ThisNode.Name, "Tooltip")
      Then: AddFact(ThisNode)
    - When: IsMatch(ThisNode.Name, "Default")
      Then: AddFact(ThisNode)

  onFunction:
    - When: IsMatch(ThisNode, "If")
      Then: AddContext(ThisNode, "Conditional Logic")
    - When: IsMatch(ThisNode, "Switch")
      Then: AddContext(ThisNode, "Multi-branch Logic")
    - When: IsMatch(ThisNode, "ShowHostInfo")
      Then: AddContext(ThisNode, "Offline Sync UX")
    - When: Not(IsMatch(ThisNode, "RGBA"))
      Then: AddFact(ThisNode)
